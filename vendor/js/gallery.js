function gal_showpict(e,a){jQuery("#gal_image").css("display","none"),jQuery("#gal_previmg, #gal_nextimg").show(),gal_prevnextwidth=200,jQuery("#gal_preimg").width(140).height(80);var i=a?"."+a:"";gal_images=jQuery(e).parent().find("img"+i),jQuery(gal_images).each(function(a){if(jQuery(this).attr("src")==jQuery(e).find("img:eq(0)").attr("src"))return gal_index=a,!1}),jQuery("#gallery").fadeTo(200,1),gal_setimage(gal_extrflnm(jQuery(e).find("img:eq(0)").attr("src"))),gal_swipe=!0}function gal_showonepict(e,a){jQuery("#gal_image").css("display","none"),jQuery("#gal_previmg, #gal_nextimg").hide(),gal_prevnextwidth=0,jQuery("#gal_preimg").width(140).height(80),gal_images=jQuery(e),gal_index=0;var i=gal_images.attr("src");1==a&&(i=gal_extrflnm(i)),jQuery("#gallery").fadeTo(200,1),gal_setimage(i),gal_swipe=!1}function gal_setimage(e){jQuery("#gal_image, #gal_previmg, #gal_nextimg").stop().fadeTo(100,0);var a=new Image;a.onload=function(){gal_imgwidth=this.width,gal_imgheight=this.height;var e=gal_setcoord(),a=e.w,i=e.h,g=this.src;if(jQuery("#gal_preimg").width()!=a||jQuery("#gal_preimg").height()!=i){var l=Math.round(Math.abs(jQuery("#gal_preimg").width()*jQuery("#gal_preimg").height()-a*i)/1500);l=(l=l>400?400:l)<150?150:l,jQuery("#gal_preimg").animate({width:a+"px",height:i+"px"},l,"swing",function(){gal_endani(g,a,i)})}else gal_endani(g,a,i)},a.src=e}function gal_setcoord(){var e=jQuery(window).width(),a=jQuery(window).height(),i=gal_imgwidth,g=gal_imgheight,l=jQuery("#gal_previmg").is(":visible")?gal_prevnextwidth:0,r=document.documentElement.clientWidth>gal_screenminwidth?gal_margin:0;if(e<i+l+2*r)var t=e-l-2*r;else t=i;if(a<g+2*r)var n=a-2*r;else n=g;return i>t&&(g/=i/t,i=t),g>n&&(i/=g/n,g=n),gal_realsize={w:Math.round(i),h:Math.round(g)},{w:Math.round(i),h:Math.round(g)}}function gal_endani(e,a,i){gal_index>0?(jQuery("#gal_previmg img").attr("src",gal_images[gal_index-1].src).show(),jQuery("#gal_previmg").removeClass("gal_repeat")):(jQuery("#gal_previmg img").hide(),jQuery("#gal_previmg").addClass("gal_repeat")),gal_index<gal_images.length-1?(jQuery("#gal_nextimg img").attr("src",gal_images[gal_index+1].src).show(),jQuery("#gal_nextimg").removeClass("gal_repeat")):(jQuery("#gal_nextimg img").hide(),jQuery("#gal_nextimg").addClass("gal_repeat")),jQuery("#gal_image").attr("src",e).stop().fadeTo(100,1),gal_images.length>1&&jQuery("#gal_previmg, #gal_nextimg").css("visibility","visible").stop().fadeTo(100,1)}function gal_resize(){var e=gal_setcoord();jQuery("#gal_preimg").width(e.w),jQuery("#gal_preimg").height(e.h),gal_pitched=!1,jQuery("#gallery").css("overflow","visible")}function gal_preshow(){0==gal_index?gal_index=gal_images.length-1:gal_index--,gal_setimage(gal_extrflnm(gal_images[gal_index].src))}function gal_nextshow(){if(gal_pitched)return jQuery("#gal_preimg").animate({width:gal_realsize.w+"px",height:gal_realsize.h+"px"},300),gal_pitched=!1,void jQuery("#gallery").css("overflow","visible");gal_images.length<2?jQuery("#gallery").click():(gal_index==gal_images.length-1?gal_index=0:gal_index++,gal_setimage(gal_extrflnm(gal_images[gal_index].src)))}function gal_extrflnm(e){return""==gal_minprefix?e:e.substr(0,e.lastIndexOf("/")+1)+e.substr(e.lastIndexOf(gal_minprefix)+gal_minprefix.length)}gal_minprefix="min_",gal_images={},gal_index=0,gal_imgwidth=0,gal_imgheight=0,gal_margin=20,gal_prevnextwidth=0,gal_screenminwidth=800,gal_swipemargin=200,gal_swipe=!0,gal_realsize={},gal_pitched=!1,jQuery(document).ready(function(){jQuery("body").append('<div id="gallery"><div id="gal_preimg"><img src="" id="gal_image" onclick="gal_nextshow()" /></div><div id="gal_previmg" onclick="gal_preshow()"><img src="" /></div><div id="gal_nextimg" onclick="gal_nextshow()"><img src="" /></div></div>'),jQuery("#gallery").click(function(e){"gallery"==e.target.id&&jQuery("#gallery").fadeTo(300,0,function(){jQuery("#gallery").css("display","none"),jQuery("#gal_preimg").css({top:0,left:0})})}),jQuery("#gallery").each(function(){this.onselectstart=function(){return!1},this.unselectable="on",jQuery(this).css({"-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-o-user-select":"none","user-select":"none"})});var e={},a=0,i=0,g=0,l={};function r(e,a){return Math.sqrt(Math.pow(e.clientX-a.clientX,2)+Math.pow(e.clientY-a.clientY,2))}jQuery("#gallery").bind({touchstart:function(i){a=0,e.x=i.originalEvent.changedTouches[0].pageX,e.y=i.originalEvent.changedTouches[0].pageY,l={w:jQuery("#gal_preimg").width(),h:jQuery("#gal_preimg").height()}},touchmove:function(t){var n=t.originalEvent.touches;if(n.length>1&&0==a&&(a=3,g=r(n[0],n[1])),3==a){var s=r(n[0],n[1])-g,_=l.h+s;_<gal_realsize.h&&(_=gal_realsize.h),_>gal_imgheight&&(_=gal_imgheight);var m=gal_imgwidth/(gal_imgheight/_);jQuery("#gal_preimg").width(m),jQuery("#gal_preimg").height(_),gal_pitched=_!=gal_realsize.h}else if(!gal_pitched){i=0;var h,u=n[0].pageX-e.x,o=n[0].pageY-e.y;if((Math.abs(u)>Math.abs(o)&&0==a||1==a)&&gal_swipe)Math.abs(u)>20&&0==a&&(a=1),h=(h=u<-gal_swipemargin?-gal_swipemargin:u)>gal_swipemargin?gal_swipemargin:h,jQuery("#gal_preimg").css("top",0),jQuery("#gallery").css("opacity",1),jQuery("#gal_preimg").css("left",h+"px"),h==gal_swipemargin&&(i=1),h==-gal_swipemargin&&(i=2);else Math.abs(o)>20&&0==a&&(a=2),h=(h=o<-gal_swipemargin?-gal_swipemargin:o)>gal_swipemargin?gal_swipemargin:h,jQuery("#gal_preimg").css("top",h+"px"),jQuery("#gallery").css("opacity",1-Math.abs(h)/gal_swipemargin),jQuery("#gal_preimg").css("left",0),Math.abs(h)==gal_swipemargin&&(i=3)}gal_pitched?jQuery("#gallery").css("overflow","auto"):jQuery("#gallery").css("overflow","visible")},touchend:function(e){0==i&&(jQuery("#gal_preimg").animate({top:0,left:0},200),jQuery("#gallery").animate({opacity:1},200)),1==i&&jQuery("#gal_preimg").animate({left:gal_swipemargin+100+"px",opacity:0},200,function(){jQuery("#gal_preimg").css("left",0),gal_preshow(),jQuery("#gal_preimg").animate({opacity:1},200)}),2==i&&jQuery("#gal_preimg").animate({left:-gal_swipemargin-100+"px",opacity:0},200,function(){jQuery("#gal_preimg").css("left",0),gal_nextshow(),jQuery("#gal_preimg").animate({opacity:1},200)}),3==i&&jQuery("#gallery").click(),i=0,a=0}})}),jQuery(window).resize(function(){jQuery("#gallery").is(":visible")&&gal_resize()}),jQuery("#photos img").click(function(){gal_showpict(this.parentNode)});